<!-- $NetBSD: chap-cons.xml,v 1.14 2005/06/11 20:25:07 rpaulo Exp $ -->

<!-- Data from htdocs/Documentation/wscons/ should be merged in here! -->

<chapter id="chap-cons">
  <title>Sterownik konsoli</title>

  <para>W &os; wersjach starszych ni¿ 1.4 u¿ytkownik móg³ wybraæ pomiêdzy dwoma ró¿nymi
  sterownikami dla ekranu i klawiatury,
    <application>pccons</application> (specyficznie dla i386) i
    <application>pcvt</application>.  W NetBSD 1.4 pojawi³ siê nowy wieloplatformowy
    sterownik
    <application>wscons</application>, który zast±pi³ poprzednie
    sterowniki.
    <application>pccons</application> jest dalej wspierany poniewaz zu¿ywa mniej
    zasobów systemowych.</para>

  <!-- ============================================================= -->

  <sect1 id="chap-cons-wscons">
    <title>wscons</title>

    <para>Wscons jest &os; standardowym sterownikiem konsoli.  Oferuje wirtualne
    terminale na i386, wspiera miêdzynarodowe klawiatury, ustawienia myszek,
    itp. Mo¿liwo¶ci wscons s± uzale¿nione od portu. Wersja i386 posiada
    ich bardzo wiele.</para>

    <sect2 id="chap-cons-wscons-vt">
      <title>Wirtualne konsole</title>

      <para>Ilo¶æ wirtualnych konsol jest kontrolowana przez nastêpujac± opcjê
      </para>

      <programlisting>options     WSDISPLAY_DEFAULTSCREENS=4</programlisting>

      <para>Inne konsole mog± zostaæ dodane przez dopisanie linii w pliku
        <filename>/etc/wscons.conf</filename> : znak komentarza (#) 
	musi zostaæ usiniêty ze wszystkich linii, zaczynaj±c od <quote>screen x</quote>.
	W przedstawionym przyk³adzie do czterech obecnie istniej±cych konsol
	dodajemy pi±t±:</para>

      <programlisting># Tworzenie konsol
#       idx     screen  emul
#screen 0       -       vt100
screen 1        -       vt100
screen 2        -       vt100
screen 3        -       vt100
screen  4       -       -
#screen 4       80x25bf vt100
#screen 5       80x50   vt100</programlisting>

      <para>Skrypt <filename>rc.wscons</filename> przetwarza ka¿d±
      niezakomentowan± liniê w wywo³aniu do <command>wsconscfg</command> komendy:
       kolumny staj± siê parametrami wywo³ania. Kolumna
        <emphasis>idx</emphasis> staje siê parametrem <option>indexu</option>
        , kolumna <emphasis>screen</emphasis> staje siê parametrem
        <option>-t type</option> (który definiuje typ konsoli:
	rzêdy i kolumny, liczbê kolorów, ...), a kolumna
        <emphasis>emul</emphasis> staje siê parametrem <option>-e emul</option>
      , który definiuje emulacjê. Na przyk³ad:</para>

      <programlisting>screen 3       -       vt100</programlisting>

      <para>staje siê wywo³aniem:</para>

      <programlisting>wsconscfg -e vt100 3</programlisting>

      <para>£atwo zauwa¿yæ, ¿e mo¿e pojawiæ siê konflikt pomiêdzy
      konsolami zaalokowanymi przez kernel i konsolami zaalokowanymi podczas
      uruchamiania przez <filename>/etc/wscons.conf</filename>.
        Je¿eli podczas rozruchu system spróbuje zaalokowac ju¿ zaalokowan±
	konsolê, zostanie wy¶wietlona nastêpuj±ca wiadomo¶æ:</para>

      <screen>wsconscfg: WSDISPLAYIO_ADDSCREEN: Device busy</screen>

      <para>Rozwi±zaniem tego problemu jest zakomentowanie b³êdnych linii w
      pliku <filename>/etc/wscons.conf</filename>.</para>

      <para>Wirtualne konsole musz± byæ aktywne w 
        <filename>/etc/ttys</filename>, aby &os; uruchomi³ program 
        &man.getty.8; do zapytania o login.  Na przyk³ad:</para>

      <programlisting>console "/usr/libexec/getty Pc"         pc3     off secure
ttyE0   "/usr/libexec/getty Pc"         vt220   on secure
ttyE1   "/usr/libexec/getty Pc"         vt220   on secure
ttyE2   "/usr/libexec/getty Pc"         vt220   on secure
ttyE3   "/usr/libexec/getty Pc"         vt220   off secure
...</programlisting>

      <para>Uruchamiany serwer X bêdzie patrzy³ za wirtualn± konsol± bez
      uruchamiania programu &man.getty.8; , na przyk³ad jedna konsola powinna
      zostaæ "wy³±czona" w <filename>/etc/ttys</filename>. Linia</para>

      <programlisting>ttyE3   "/usr/libexec/getty Pc"         vt220   off secure</programlisting>

      <para>w <filename>/etc/ttys</filename> jest u¿ywana przez serwer X do tego
      celu. W celu u¿ycia innej konsoli ni¿ 4, nale¿y podaæ parametr
      formy vt <replaceable>n</replaceable> serwera X,
      gdzie <replaceable>n</replaceable> jest numerem klucza funkcjonalnego
      u¿ywanego do aktywacji konsoli dla X.</para>

      <para>Na przyk³ad, <quote>screen 7</quote> mo¿e zostaæ umo¿liwiony w
      <filename>/etc/wscons.conf</filename> i X mo¿e byæ wystartowany z
        <quote>vt8</quote>.  Je¿eli u¿ywasz <application>xdm</application>,
	musisz wyedytowaæ <filename>/usr/X11R6/lib/X11/xdm/Xserver</filename>.
	Na przyk³ad:</para>

      <programlisting>:0 local /usr/X11R6/bin/X +kb dpms -bpp 16 dpms vt8</programlisting>

      <para>Dla <application>xdm3d</application> ¶cie¿ka jest inna:
        <filename>/usr/X11R6/share/xdm3d/Xservers</filename>.</para>
    </sect2>

    <!-- ........................................................... -->

    <sect2 id="chap-cons-wscons-50lines">
      <title>50 liniowy tryb tekstowy z wscons</title>

      <para>Tryb tekstowy z 50 liniami mo¿e zostaæ u¿ywany do startowania z
      wersj± 1.4.1 &os;.  Ten tryb jest aktywowany w 
        <filename>/etc/wscons.conf</filename>.  Nastepuj±ce linie musz± zostaæ
	odkomentowane:</para>

      <programlisting>font ibm  -  8  ibm  /usr/share/pcvt/fonts/vt220l.808</programlisting>

      <para>Nastêpuj±ce linie musz± zostaæ zmodyfikowane:</para>

      <programlisting>#screen 0       80x50   vt100
screen  1       80x50   vt100
screen  2       80x50   vt100
screen  3       80x50   vt100
screen  4       80x50   vt100
screen  5       80x50   vt100
screen  6       80x50   vt100
screen  7       80x50   vt100</programlisting>

      <para>Ta konfiguracja uruchamia osiem konsol, które s± dostêpne dziêki
      kombinacji klawiszy Ctrl-Alt-F<emphasis>n</emphasis> (gdzie
        <emphasis>n</emphasis> jest 1 do 8); 
	odpowiadaj±cymi urz±dzeniami s± ttyE0..ttyE7.  
	¯eby je uruchomiæ i dostaæ zapytanie o login, plik
        <filename>/etc/ttys</filename> musi zostaæ zmodyfikowany:</para>

      <programlisting>ttyE0   "/usr/libexec/getty Pc"         vt220   on secure
ttyE1   "/usr/libexec/getty Pc"         vt220   on secure
ttyE2   "/usr/libexec/getty Pc"         vt220   on secure
ttyE3   "/usr/libexec/getty Pc"         vt220   on secure
ttyE4   "/usr/libexec/getty Pc"         vt220   on secure
ttyE5   "/usr/libexec/getty Pc"         vt220   on secure
ttyE6   "/usr/libexec/getty Pc"         vt220   on secure
ttyE7   "/usr/libexec/getty Pc"         vt220   on secure</programlisting>

      <para>Nie ma mo¿liwo¶ci zmieny ustawienia 80x25 na konsoli 0,
      prawdopodobnie ¿eby zagwarantowac ¿e w razie problemów tam jest zawsze
      dzia³aj±ca konsola.</para>

    </sect2>

    <!-- ........................................................... -->

    <sect2 id="chap-cons-wscons-keymaps">
      <title>Mapowanie klawiatury</title>

      <para>Wscons pozwala równie¿ na zmianê mapowania klawiatury na narodowych
      klawiaturach. Na przyk³ad, aby u¿ywaæ mapowanie dla w³oskiej klawiatury,
      nale¿y wpisaæ:</para>

      <screen>&rprompt; <userinput>wsconsctl -k -w encoding=it</userinput>
kodowanie -> it</screen>

      <para>To ustawienie bêdzie dzia³a³o do ponownego uruchomienia komputera.
       ¯eby ustawiæ to na sta³e dodaj linie <quote>encoding</quote>do
        <filename>/etc/wscons.conf</filename>: to bêdzie automatycznie
	uruchamiane nastêpnego razu kiedy zrestartujesz komputer.</para>

      <screen>
&rprompt; <userinput>cp /etc/wscons.conf /etc/wscons.conf.orig</userinput>
&rprompt; <userinput>echo encoding it &gt;&gt;/etc/wscons.conf</userinput></screen>

      <para>Nale¿y byæ bardzo ostro¿nym i wpisaæ dok³adnie dwa znaki <quote>&gt;</quote> .
        Je¿eli dodasz tylko jeden <quote>&gt;</quote>, nadpiszesz ten plik
	zamiast dodaæ liniê. Miêdzy innymi dlatego zawsze robimy kopiê plików przed ich
	modyfikacj±!</para>

      <para>Pe³n± listê mapowañ klawiatury mo¿esz znale¼æ w pliku
        <filename>/usr/src/sys/dev/wscons/wsksymdef.h</filename>:</para>

      <itemizedlist>
        <listitem><para>be - Belgijski</para></listitem>
        <listitem><para>de - Niemiecki</para></listitem>
        <listitem><para>dk - Duñski</para></listitem>
        <listitem><para>es - Estonski</para></listitem>
        <listitem><para>fr - Francuski</para></listitem>
        <listitem><para>hu - Wêgierski</para></listitem>
        <listitem><para>it - W³oski</para></listitem>
        <listitem><para>jp - Japoñski</para></listitem>
        <listitem><para>no - Norweski</para></listitem>
        <listitem><para>pl - Polski</para></listitem>
        <listitem><para>pt - Portugalski</para></listitem>
        <listitem><para>ru - Rosyjski</para></listitem>
        <listitem><para>sf - Szwajcarsko Francuski</para></listitem>
        <listitem><para>sg - Szwajcarsko Niemiecki</para></listitem>
        <listitem><para>sv - Szwajcarski</para></listitem>
        <listitem><para>ua - Ukraiñski</para></listitem>
        <listitem><para>uk - UK-Angielski</para></listitem>
        <listitem><para>us - US-Angielski</para></listitem>
      </itemizedlist>

    </sect2>

    <!-- ........................................................... -->

    <sect2 id="chap-cons-wscons-wsmouse">
      <title>Kopiowanie i wklejanie w konsoli za pomoc± wsmoused</title>

      <para>Istnieje mo¿liwo¶æ korzystania z myszki w konsoli wscons do zaznaczenia (kopiowania)
      tekstu za pomoc± jednego przycisku myszy i wklejenia go z powrotem innym
      przyciskiem. Aby umo¿lowiæ korzystanie z kopiowania i wklejania w wscons, nale¿y
      najpierw wbudowaæ obs³ugê tej mo¿liwo¶ci w kernelu. Domy¶lnie jest ona
      wy³±czona. Aby to zrobiæ, nale¿y dodaæ nastêpuj±ce opcje:</para>

      <programlisting>options WSDISPLAY_CHARFUNCS             # mouse console support</programlisting>

      <para><emphasis>Wystrzegaj siê</emphasis> tego, ¿e ta opcja nie bêdzie
      dzia³aæ ³±cznie z opcj± <option>VGA_RASTERCONSOLE</option>.
        Wiêcej informacji na temat kompilacji kernela znajduje siê w <xref
	linkend="chap-kernel" />.
	</para>

      <para>Po zbudowaniu kernela nale¿y dodaæ opcjê "wsmoused" w pliku
        <filename>/etc/rc.conf</filename> i wpisaæ:</para>

      <screen>&rprompt; <userinput>echo wsmoused=yes &gt;&gt;/etc/rc.conf</userinput>
&rprompt; <userinput>sh /etc/rc.d/wsmoused start</userinput> </screen>

      <para>Po tym zabiegu powinno byæ mo¿liwe 
      zaznaczanie tekstu lewym klawiszem myszy i wklejania go prawym. Aby 
      zmieniæ to zachowanie &man.wsmoused.8; nale¿e zapoznaæ siê ze stron±
      podrêcznika man opisuj±c± format pliku konfiguracyjnego
      &man.wsmoused.conf.5;. Przyk³adowy plik to 
        <filename>/usr/share/examples/wsmoused</filename>.</para>
    </sect2>

    <!-- ........................................................... -->

    <sect2 id="chap-cons-wscons-scrolling">
      <title>Uruchamianie scrollback w konsoli</title>

      <para>Mo¿esz uruchomiæ scrollback na konsolach wscons przez wkompilowanie
      opcji <option>WSDISPLAY_SCROLLSUPPORT</option> do 
        kernela. Nale¿y siê upewnie, ¿e nie jest jednocze¶nie w³±czona opcja
        <option>VGA_RASTERCONSOLE</option>! Instrukcje dotycz±ce kompilacji
	kernela znajduj± siê w <xref linkend="chap-kernel" />.</para>

      <para>Kiedy masz ju¿ dzia³aj±cy kernel z opcj±
        <option>WSDISPLAY_SCROLLSUPPORT</option>, 
	mo¿esz przewijaæ na konsolê za pomoc± klawiszy LEFT SHIFT i PAGE
        UP/DOWN. Zauwa¿, ¿e to mo¿e nie dzia³aæ na konsoli systemowej (ttyE0)!</para>
    </sect2>
  </sect1>

  <!-- ============================================================= -->

  <sect1 id="chap-cons-pccons">
    <title>pccons</title>

    <para>Ten sterownik konsoli nie oferuje konsol wirtualnych i programu
    narzêdziowego do ich konfiguracji. Pccons
    mo¿na znale¿æ na instalacyjnej dyskietce i386.</para>

    <para>¯eby uruchomiæ ten sterownik, dodajemy nastêpujace liniê do pliku konfiguracyjnego
    kernela:</para>

    <programlisting>pc0 at isa? port 0x60 irq 1 # pccons generic PC console driver</programlisting>

    <para>Mo¿na te¿ ustawiæ jedn± z kilkunastu opcji do kompilacji w
    innym ni¿ angielskie mapowaniu klawiatury:</para>

    <programlisting># Ustawienia klawiatury dla pccons
#options        FRENCH_KBD
#options        FINNISH_KBD
#options        GERMAN_KBD
#options        NORWEGIAN_KBD</programlisting>

    <para>Usuñ komentarze z linii do odpowiedniego mapowania i postepuj
    wed³ug instrukcji w <xref
      linkend="chap-kernel" /> w celu przebudowania kernela.</para>

    <para>W praktyce nie pccons nie bêdzie potrzebne, wscons powinno wystarczyæ do wiêkszo¶ci potrzeb.</para>
  </sect1>
</chapter>
